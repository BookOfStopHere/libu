#!/bin/sh
#
# $Id: configure,v 1.25 2006/02/24 20:24:31 stewy Exp $

export makl_conf_h=libu_conf.h

# Be sure MAKL_DIR is there.
if [ -z "${MAKL_DIR}" ]; then
    echo "====================================================================="
    echo "  WARNING: it seems that MaKL is not installed/configured in your    "
    echo "           environment.  See http://www.koanlogic.com/products/makl  "
    echo "           for download, installation and configuration information. "
    echo "====================================================================="
    exit 1
fi

# MaKL preamble
. ${MAKL_DIR}/cf/makl.init

makl_args_init "$@"

# Custom arguments ...
makl_args_def "enable_debug"    "" "" "enables debugging"
makl_args_def "enable_profile"  "" "" "enables profiling"
makl_args_def "enable_warns"    "" "" "set CFLAGS for extra warnings"
makl_args_def "no_hmap"         "" "" "disable hmap module"
makl_args_def "no_config"       "" "" "disable config module"
makl_args_def "no_log"          "" "" "disable log module"
makl_args_def "no_net"          "" "" "disable net module"
makl_args_def "no_env"          "" "" "disable env module"
# ... and their handlers
__makl_enable_debug ()   { makl_append_var_mk "CFLAGS" "-g -DDEBUG" ; }
__makl_enable_profile () { makl_append_var_mk "CFLAGS" "-pg" ; }
__makl_enable_warns ()
{
    makl_append_var_mk "CFLAGS" "-W -Wall -Wstrict-prototypes -Wmissing-prototypes" \
                                "-Wpointer-arith -Wno-uninitialized -Wreturn-type" \
                                "-Wwrite-strings -Wswitch -Wshadow -Wwrite-strings" \
                                "-Wunreachable-code -Wunused -Wcast-qual -pedantic"
}
__makl_no_hmap ()   { makl_set_var_mk "NO_HMAP" ; }
__makl_no_config () { makl_set_var_mk "NO_CONFIG" ; }
__makl_no_log ()    { makl_set_var_mk "NO_LOG" ; }
__makl_no_net ()    { makl_set_var_mk "NO_NET" ; }
__makl_no_env ()    { makl_set_var_mk "NO_ENV" ; }

# General settings (version is read from the VERSION file)
makl_pkg_name "libu"
makl_pkg_version

# Set variables depending on host OS
case `makl_os_name` in
    *mingw* | *MINGW*)
        makl_set_var_h "OS_WIN"
        makl_set_var_h "U_PATH_SEPARATOR" "'\\\\\\\\'"
        ;;
    *)
        makl_set_var_h "OS_UNIX"
        makl_set_var_h "U_PATH_SEPARATOR" "'/'"
        ;;
esac

# C Flags
makl_append_var_mk "CFLAGS" "-DHAVE_CONF_H -I`pwd` -O2"

# Install headers in a private subdir
makl_append_var_mk "INCDIR" "\${DESTDIR}/include/u"

# Binary dependencies
makl_optional           1    "featx"   "doxygen"    "PATH_DOXYGEN"

## Function dependencies
makl_checktype          0   "pid_t"     "<sys/types.h>" 
makl_checkfunc          0   "getpid"
makl_checkfunc          0   "unlink"
makl_checkfunc          0   "syslog"
makl_checkfunc          0   "strtok_r"
makl_checkfunc          0   "fnmatch"
makl_checkfunc          0   "timegm"
makl_checkfunc          0   "strsep"
makl_checkfunc          0   "gettimeofday"
makl_func_strerror_r    0

# Handle command-line arguments
makl_args_handle "$@"

# MaKL closing
. ${MAKL_DIR}/cf/makl.term
