#!/bin/sh
#
# $Id: configure,v 1.20 2006/01/09 15:38:33 tho Exp $

export makl_conf_h=libu_conf.h

# Be sure MAKL_DIR is there.
if [ -z "${MAKL_DIR}" ]; then
    echo "====================================================================="
    echo "  WARNING: it seems that MaKL is not installed/configured in your    "
    echo "           environment.  See http://www.koanlogic.com/products/makl  "
    echo "           for download, installation and configuration information. "
    echo "====================================================================="
    exit 1
fi

# MaKL preamble
. ${MAKL_DIR}/cf/makl.init

makl_args_init "$@"

# Custom arguments ...
makl_args_def "enable_debug"    "" "" "enables debugging"
makl_args_def "enable_profile"  "" "" "enables profiling"
makl_args_def "enable_warns"    "" "" "set CFLAGS for extra warnings"
# ... and their handlers
__makl_enable_debug ()   { makl_add_var_mk "CFLAGS" "-g -DDEBUG" ; }
__makl_enable_profile () { makl_add_var_mk "CFLAGS" "-pg" ; }
__makl_enable_warns ()
{
    makl_add_var_mk "CFLAGS" "-W -Wall -Wstrict-prototypes -Wmissing-prototypes"
    makl_add_var_mk "CFLAGS" "-Wpointer-arith -Wno-uninitialized -Wreturn-type"
    makl_add_var_mk "CFLAGS" "-Wwrite-strings -Wswitch -Wshadow -Wwrite-strings"
    makl_add_var_mk "CFLAGS" "-Wunreachable-code -Wunused -Wcast-qual"
}

# General settings (version is read from the VERSION file)
makl_pkg_name "libu"
makl_pkg_version

# Set variables depending on host OS
case `makl_os_name` in
    *mingw* | *MINGW*)
        makl_set_var_h "OS_WIN"
        makl_set_var_h "U_PATH_SEPARATOR" "'\\\\\\\\'"
        ;;
    *)
        makl_set_var_h "OS_UNIX"
        makl_set_var_h "U_PATH_SEPARATOR" "'/'"
        ;;
esac

# C Flags
makl_add_var_mk "CFLAGS" "-DHAVE_CONF_H -I`pwd` -O2 -std=c99 -pedantic"

# Install headers in a private subdir
makl_add_var_mk "INCDIR" "\${DESTDIR}/include/u"

# Binary dependencies
makl_optional           1    "featx"   "doxygen"    "PATH_DOXYGEN"

## Function dependencies
makl_checktype          0   "pid_t"     "<sys/types.h>" 
makl_checktype          0   "pid_t"     "<sys/types.h>" 
makl_checkfunc          0   "getpid"
makl_checkfunc          0   "unlink"
makl_checkfunc          0   "syslog"
makl_checkfunc          0   "strtok_r"
makl_checkfunc          0   "fnmatch"
makl_checkfunc          0   "timegm"
makl_checkfunc          0   "strsep"
makl_checkfunc          0   "gettimeofday"
makl_func_strerror_r    0

# Handle command-line arguments
makl_args_handle "$@"

# MaKL closing
. ${MAKL_DIR}/cf/makl.term
