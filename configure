#!/bin/sh
#
# $Id: configure,v 1.10 2005/10/31 11:05:12 tat Exp $

export makl_debug=1

# Be sure MAKL_DIR is there.
# If not found assume MaKL has been embedded in the package.
if [ -z "${MAKL_DIR}" ] 
then
    if [ -d `pwd`/makl ]
    then
        export MAKL_DIR=`pwd`/makl
    else
        echo "MaKL MUST be installed and MAKL_DIR set in the environment"
        exit 1
    fi
fi

# MaKL preamble
. ${MAKL_DIR}/cf/makl.init

makl_args_init "$@"

# Custom arguments ...
makl_args_def "enable_debug"    "" "" "enables debugging"
makl_args_def "enable_profile"  "" "" "enables profiling"
# ... and their handlers
__makl_enable_debug ()   { makl_add_var_mk "CFLAGS" "-g" ; }
__makl_enable_profile () { makl_add_var_mk "CFLAGS" "-pg" ; }

# General settings (version is read from the VERSION file)
makl_pkg_name "libu"
makl_pkg_version

# Set variables depending on host OS
case `makl_os_name` in
    *-*-mingw*)
        makl_set_var_h "OS_WIN"
        makl_set_var_h "U_PATH_SEPARATOR" "'\\'"
        ;;
    *)
        makl_set_var_h "OS_UNIX"
        makl_set_var_h "U_PATH_SEPARATOR" "'/'"
        ;;
esac

# C Flags
makl_add_var_mk "CFLAGS" "-DHAVE_CONF_H" \
                         "-std=c99 -pedantic" \
                         "-W -Wall -Wstrict-prototypes -Wmissing-prototypes" \
                         "-Wpointer-arith -Wno-uninitialized -Wcast-qual" \
                         "-Wreturn-type -Wwrite-strings -Wswitch -Wshadow"

# Install headers in a private subdir
makl_add_var_mk "INCDIR" "\${DESTDIR}/include/u"

# Binary dependencies
makl_optional           1    "featx"   "doxygen"    "PATH_DOXYGEN"

## Function dependencies
makl_checktype          1   "pid_t"     "<sys/types.h>"
makl_checkfunc          1   "getpid"
makl_checkfunc          1   "unlink"
makl_checkfunc          1   "syslog"
makl_checkfunc          1   "strtok_r"
makl_checkfunc          1   "fnmatch"
makl_func_strerror_r    1

# Handle command-line arguments
makl_args_handle "$@"

# MaKL closing
. ${MAKL_DIR}/cf/makl.term
